webpackJsonp([0],[function(e,t,i){"use strict";var n=i(1),a=i(2),o=i(7),s=(i(15),e.exports={});window.Grove={version:"0.1.1",release:"pre-alpha",revision:7,globals:function(){return s}},console.log("%cThe Grove\nv"+window.Grove.version+" "+window.Grove.release+" r"+window.Grove.revision+"\nHave fun in the console ðŸ˜‰","color: green; font-weight: bold; font-size: 14px;"),s.camera=new n.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),s.scene=new n.Scene,s.renderer=new n.WebGLRenderer({antialias:!0}),s.world=new a.World,s.items=i(16),s.adventures=i(8).adventures,s.quests=i(8).quests,s.npcs=i(17),s.maps=i(18),s.map=null,s.player=null,s.entities=[],s.particles=[],s.tweens=[],s.mods=[],s.events=o.channel("events"),s.controls=null,s.time=Date.now(),s.clock=new n.Clock,s.debugRenderer=new n.CannonDebugRenderer(s.scene,s.world),s.generateUUID=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)}).toUpperCase()},s.entityByID=function(e){var t=void 0,i=!0,n=!1,a=void 0;try{for(var o,r=s.entities[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var l=o.value;l.id==e&&(t=l)}}catch(e){n=!0,a=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw a}}return t||null},s.entityByBodyID=function(e){var t=void 0,i=!0,n=!1,a=void 0;try{for(var o,r=s.entities[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var l=o.value;l.body.id==e&&(t=l)}}catch(e){n=!0,a=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw a}}return t||null}},,,,function(e,t,i){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Mod=t.Adventure=t.Quest=t.NPC=t.Player=t.Map=t.AI=t.Living=t.Inventory=t.Item=void 0;var r=function e(t,i,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,i);if(void 0===a){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in a)return a.value;var s=a.get;if(void 0!==s)return s.call(n)},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=i(6),c=i(21),d=n(c),p=i(22),v=n(p),f=i(1),m=i(2),y=i(5),w=i(7),g=i(3),b=i(0),x=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.Object3D,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new m.Body;s(this,e),this.id=t,this.uuid=b.generateUUID(),"object"==(void 0===i?"undefined":l(i))?(this.mesh=i,this.mesh.castShadow=!0,this.mesh.recieveShadow=!0,b.scene.add(i)):this.loadModel(i),this.body=n,b.world.add(n),this.events=w.channel(this.uuid),this.last=[],this.audio=Array,b.entities.push(this)}return h(e,[{key:"update",value:function(){this.mesh&&(this.mesh.position.copy(this.body.position),this.meshData&&this.meshData.offset&&(this.mesh.position.y+=this.meshData.offset[1]),this.publish("update"))}},{key:"remove",value:function(){b.scene.remove(this.mesh),b.world.remove(this.body),b.entities.splice(b.entities.indexOf(this),1)}},{key:"subscribe",value:function(e,t){return this.events.subscribe(e,t)}},{key:"publish",value:function(e,t){return this.events.publish(e,t)}},{key:"loadAudio",value:function(e,t){}},{key:"playAudio",value:function(e){}},{key:"loadModel",value:function(e){var t=this;this.mesh=new f.Object3D,b.scene.add(this.mesh),(new f.JSONLoader).load(e,function(e,i){var n=new f.Mesh(e,i);n.castShadow=!0,n.recieveShadow=!0,t.mesh.add(n)})}}]),e}();t.default=x;var k=t.Item=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];s(this,e),this.id=t,this.uuid=b.generateUUID(),this.slot=String,this.type="item",this.name=String,this.desc=String,this.value=Number,this.weight=Number,this.buffs=Array,this.stats=Array,i&&this.loadFromJSON(i)}return h(e,[{key:"loadFromJSON",value:function(e){if(!b.items[this.id])throw"Uncaught ItemError: cannot find item with ID of "+this.id+"!";var t=b.items[this.id];for(var i in t)this[i]=t[i]}},{key:"drop",value:function(e){var t=this,i=(new f.SphereGeometry(.2,32,32),new f.MeshLambertMaterial({color:255}),new m.Sphere(.2)),n=new m.Body({mass:5});n.addShape(i),n.linearDamping=.9,this.entity=new x(this.id,this.model,n),this.entity.type="item",this.entity.name=this.name,this.entity.mesh.rotation.x=Math.PI/2,this.entity.body.position.set(e.x,e.y,e.z),this.meshData&&this.meshData.general&&this.meshData.general.scale&&this.entity.mesh.scale.set(this.meshData.general.scale[0],this.meshData.general.scale[1],this.meshData.general.scale[2]),this.entity.subscribe("interact",function(e){t.entity.remove(),t.entity=null,e.inv.add(t),new Audio("/assets/audio/sfx/npc-pick-1.mp3").play()})}},{key:"addBuff",value:function(e){}},{key:"removeBuff",value:function(e){}},{key:"clearBuffs",value:function(){}}]),e}(),D=t.Inventory=function(){function e(t,i,n){s(this,e),this.owner=t,this.weight=0,this.maxWeight=i,this.equipped={},this.inv=[]}return h(e,[{key:"addSlot",value:function(e){if("string"!=typeof e||this.equipped[e]){if("object"==(void 0===e?"undefined":l(e))){var t=!0,i=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;this.equipped[s]||(this.equipped[s]=null,this.owner.publish("inv.addSlot",{slot:s}))}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}}}else this.equipped[e]=null,this.owner.publish("inv.addSlot",{slot:e});return this.calculateWeight(),this}},{key:"getSlot",value:function(e){if(this.equipped[e])return this.equipped[e]}},{key:"setSlot",value:function(e,t){if(!this.equipped[e])return this.equipped[e]=t,this.calculateWeight(),this.owner.publish("inv.setSlot"),this}},{key:"add",value:function(e){if(!e.id||!e.slot)throw"Uncought ItemError: essential data not defined!";this.inv.push(e);var t=e.slot;return"hand"==e.slot&&(t=this.equipped.rh?"lh":"rh",e.slot=t),this.equipped[t]||this.equip(e.uuid),this.calculateWeight(),this.owner.publish("inv.add",{item:e}),this}},{key:"drop",value:function(e){var t=!0,i=!1,n=void 0;try{for(var a,o=this.inv[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;s.uuid==e&&(this.inv.splice(this.inv.indexOf(s),1),s.drop(this.owner.body.position))}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}return this.calculateWeight(),this.owner.publish("inv.drop"),this}},{key:"dropAll",value:function(){this.unequipAll();var e=!0,t=!1,i=void 0;try{for(var n,a=this.inv[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){n.value.drop(this.owner.body.position)}}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}this.inv.splice(0,this.inv.length),this.owner.publish("inv.dropAll"),this.calculateWeight()}},{key:"equip",value:function(e){var t=null,i=!0,n=!1,a=void 0;try{for(var o,s=this.inv[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var r=o.value;r.uuid==e&&(t=r,this.inv.splice(this.inv.indexOf(t),1))}}catch(e){n=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}if(!t)return this;var l=t.slot;return"hand"==t.slot&&(l=this.equipped.rh?"lh":"rh"),this.setSlot(l,t),this.calculateWeight(),this.owner.publish("inv.equip",{item:t,slot:l}),this}},{key:"unequip",value:function(e){if(this.equipped[e])return this.inv.push(this.equipped[e]),this.owner.publish("inv.unequip",{item:this.equipped[e],slot:e}),this.equipped[e]=null,this.calculateWeight(),this}},{key:"unequipAll",value:function(){for(var e in this.equipped)this.unequip(e);return this.owner.publish("inv.unequipAll"),this}},{key:"calculateWeight",value:function(){var e=0;for(var t in this.equipped)this.equipped[t]&&(e+=this.equipped[t].weight);for(var i in this.inv)this.inv[i]&&(e+=this.inv[i].weight);return this.weight=e,this.weight>this.maxWeight&&console.log("You are carrying to much to run."),this}}]),e}(),S=t.Living=function(e){function t(e,i,n){s(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));return o.inv=new D(o,150,[]),o.type="living",o.holding=[],o.subscribe("swing",function(e){var t=e.slot;if(o.holding[t]&&0==o.holding[t].rotation.x){var i=o.inv.getSlot(t);if(t&&o.holding[t]){var n=new y.Tween(o.holding[t].rotation).to({x:["player"==o.id?-Math.PI/2:Math.PI/2,0]},i.stats.spd).onComplete(function(){b.tweens.splice(b.tweens.indexOf(o),1),o.last.used[t]=Date.now()}).start();b.tweens.push(n)}}}),o.last.spoke=Date.now(),o.last.used=[],o.subscribe("inv.addSlot",function(e){var t=e.slot;o.last.used[t]=Date.now()}),o.stats={hp:Number,hpMax:Number,stm:Number,stmMax:Number,mp:Number,mpMax:Number,str:Number,per:Number,end:Number,chr:Number,int:Number,agi:Number},o}return o(t,e),h(t,[{key:"update",value:function(){r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this)}},{key:"damage",value:function(e,t){this.stats.hp-=e,this.publish("damage"),this.stats.hp<=0&&(this.stats.hp=0,this.kill(t))}},{key:"revive",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.hp+=e,this.stm+=t,this.mp+=i,this.hp>this.hpMax&&(this.hp=this.hpMax),this.stm>this.stmMax&&(this.stm=this.stmMax),this.mp>this.mpMax&&(this.mp=this.mpMax)}},{key:"attack",value:function(e,t,i){b.controls.enabled&&(t.damage(e,this),this.publish("attack"),this.publish("swing",{slot:i}))}},{key:"kill",value:function(e){this.inv.dropAll(),this.publish("kill",{attacker:e}),b.events.publish("entity.kill",{killer:e.id,killed:this.id}),this.remove()}},{key:"speak",value:function(e){}}]),t}(x),q=t.AI=function(e){function t(e,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"bystander";s(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));return r.behavior="string"==typeof o?d[o]:o,r.behavior=r.behavior.bind(r),r.hostility=Array,r.personality=Array,r.closest=null,r}return o(t,e),h(t,[{key:"update",value:function(){r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this),this.mesh&&(this.closest&&this.mesh.position.distanceTo(this.closest.mesh.position)>100&&(this.publish("closest.lose"),this.closest=null),this.behavior())}},{key:"nearestEntity",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,a=b.entities[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var o=n.value;o.uuid!=this.uuid&&("living"==o.type&&(this.mesh.position.distanceTo(o.mesh.position)>50||(null==this.closest&&(this.closest=o),this.closest&&this.mesh.position.distanceTo(o.mesh.position)<this.mesh.position.distanceTo(this.closest.mesh.position)&&(this.closest=o))))}}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}return this.closest}}]),t}(S),M=(t.Map=function(){function e(t){s(this,e),this.id=t,this.type="map",this.loadModel(t)}return h(e,[{key:"loadModel",value:function(e){function t(e){var t=this;if(e instanceof f.Mesh){var i=e.geometry.clone();i.applyMatrix((new f.Matrix4).makeScale(30,30,30));for(var n=[],a=[],o=0;o<i.vertices.length;o++){var s=i.vertices[o];n.push(new m.Vec3(s.x,s.y,s.z))}for(var r=0;r<i.faces.length;r++){var l=i.faces[r];a.push([l.a,l.b,l.c])}var h=new m.ConvexPolyhedron(n,a),c=new m.Body({mass:0,material:b.mat});c.addShape(h),c.position.copy(e.position),c.quaternion.copy(e.quaternion);var d=new x(e.name.toLowerCase(),e,c);this.meshData.blender||d.mesh.scale.set(1,1,1),d.type="map",d.name=e.name;for(var p in this.meshData.children)!function(i){var n=t.meshData.children[i];new RegExp(i,"gi").test(e.name.toLowerCase())&&(n.type&&(d.type=n.type,"link"==d.type&&d.subscribe("interact",function(){(0,u.Save)("map",n.location),window.location.reload()})),n.name&&(d.name=n.name))}(p)}}var i=this;this.loadData(),(new f.JSONLoader).load(this.path,function(e,n){var a=new f.Mesh(e,n);a.scale.set(30,30,30),t.bind(i)(a)})}},{key:"loadData",value:function(){if(!b.maps[this.id])throw"MapError: map with id "+this.id+" not found!";for(var e in b.maps[this.id])this[e]=b.maps[this.id][e]}}]),e}(),t.Player=function(e){function t(e,i,n){s(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));return o.stats.hp=o.stats.hpMax=100,o.stats.stm=o.stats.stmMax=100,o.stats.mp=o.stats.mpMax=100,o.inv.addSlot(["head","chest","legs","lh","rh"]),o.subscribe("inv.equip",function(e){var t=e.item,i=e.slot;"rh"!=i&&"lh"!=i||(new f.JSONLoader).load(t.model,function(e,n){var a=new f.Mesh(e,n);if(t.meshData&&(t.meshData.general&&t.meshData.general.scale&&a.scale.set(t.meshData.general.scale[0],t.meshData.general.scale[1],t.meshData.general.scale[2]),t.meshData.equipped)){if(t.meshData.equipped.particles&&a.add((new v[t.meshData.equipped.particles]).group.mesh),t.meshData.equipped.light){var s=t.meshData.equipped.light,r=new f.PointLight(new f.Color(s[0]),s[1],s[2],s[3]);r.translateY(.5),a.add(r)}if(t.meshData.equipped.scale){var l=t.meshData.equipped.scale;a.scale.set(l[0],l[1],l[2])}}a.position.set("rh"==i?.8:-.8,-.5,-1),b.camera.add(a),o.holding[i]=a;var h=o.subscribe("inv.unequip",function(e){i==e.slot&&(b.camera.remove(a),o.holding[i]=null,h.unsubscribe())})})}),o}return o(t,e),h(t,[{key:"attack",value:function(e,i,n){0===this.holding[n].rotation.x&&(Date.now()-this.last.used[n]<this.inv.getSlot(n).stats.cooldown||r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attack",this).call(this,e,i,n))}},{key:"kill",value:function(e){r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"kill",this).call(this,e),g("#blocker").show(),g("#instructions").html("THOU HATH PERISHED<br><small>[ courtesy of "+e.name+" ]</small>")}}]),t}(S),t.NPC=function(e){function t(e,i,n){s(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n,"bystander"));if(!b.npcs[e])throw"Uncaught EntityError: NPC with id "+o.id+" not found!";for(var r in b.npcs[e])o[r]=b.npcs[e][r];return!o.stats.hp&&o.stats.hpMax&&(o.stats.hp=o.stats.hpMax),!o.stats.stm&&o.stats.stmMax&&(o.stats.stm=o.stats.stmMax),o.inv.addSlot(["head","chest","legs","lh","rh"]),o.loadModel(o.path),o.subscribe("damage",function(){o.behavior=d.aggressive}),o.subscribe("inv.equip",function(e){var t=e.item,i=e.slot;"rh"!=i&&"lh"!=i||(new f.JSONLoader).load(t.model,function(e,n){var a=new f.Mesh(e,n);if(a.translateX("rh"==i?-1:1),a.translateY(3),a.translateZ(.5),t.meshData&&(t.meshData.general&&t.meshData.general.scale&&a.scale.set(t.meshData.general.scale[0],t.meshData.general.scale[1],t.meshData.general.scale[2]),t.meshData.equipped)){if(t.meshData.equipped.particles&&a.add((new v[t.meshData.equipped.particles]).group.mesh),t.meshData.equipped.light){var s=t.meshData.equipped.light,r=new f.PointLight(new f.Color(s[0]),s[1],s[2],s[3]);r.translateY(.5),a.add(r)}if(t.meshData.equipped.scale){var l=t.meshData.equipped.scale;a.scale.set(l[0],l[1],l[2])}}o.mesh.add(a),o.holding[i]=a})}),o.subscribe("closest.lose",function(){o.behavior==d.aggressive&&(o.behavior=d.bystander)}),o.body.addEventListener("collide",function(e){var t=b.entityByBodyID(e.body.id);t&&"living"==t.type&&Date.now()-o.last.spoke>5e3&&(o.speak(Math.random()<.5?"/assets/audio/sfx/npc-bump-1.mp3":"/assets/audio/sfx/npc-bump-2.mp3"),o.last.spoke=Date.now())}),o}return o(t,e),h(t,[{key:"attack",value:function(e,i,n){0===this.holding[n].rotation.x&&(Date.now()-this.last.used[n]<this.inv.getSlot(n).stats.cooldown||r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attack",this).call(this,e,i,n))}},{key:"loadModel",value:function(e){r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"loadModel",this).call(this,e),this.meshData.scale&&this.mesh.scale.set(this.meshData.scale[0],this.meshData.scale[1],this.meshData.scale[2])}}]),t}(q),t.Quest=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];s(this,e),this.id=t,this.name=String,this.desc=String,this.listeners=Array,this.fulfilled=Number,this.onComplete=Array,i&&(this.loadData(t),n&&this.start())}return h(e,[{key:"loadData",value:function(e){if(!b.quests[e])throw"QeustError: Quest with id "+e+" not found!";for(var t in b.quests[e])this[t]=b.quests[e][t];this.fulfilled=this.listeners.length}},{key:"start",value:function(){var e=this,t=!0,i=!1,n=void 0;try{for(var a,o=this.listeners[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)!function(){var t=a.value,i=b.events.subscribe("string"==typeof t?t:t.id,function(n){if("object"==(void 0===t?"undefined":l(t)))for(var a in t)if("id"!=a&&n[a]!=t[a])return;e.fulfilled--,e.fulfilled<=0&&e.complete(),i.unsubscribe()})}()}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}}},{key:"complete",value:function(){console.log("Quest "+this.id+" complete!");var e=!0,t=!1,i=void 0;try{for(var n,a=this.onComplete[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var o=n.value;switch(o.type){case"give":b.entityByID(o.target).inv.add(new k(o.item));break;default:return}}}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}this.oncomplete&&this.oncomplete()}}]),e}());t.Adventure=function(e){function t(e){s(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,!0,!0));return i.listeners=null,i}return o(t,e),h(t,[{key:"loadData",value:function(e){if(!b.adventures[e])throw"AdventureError: Adventure with id "+e+" not found!";for(var t in b.adventures[e])this[t]=b.adventures[e][t];this.fulfilled=0}},{key:"start",value:function(){for(var e=this,t=0;t<this.quests.length;t++)this.quests[t]=new M(this.quests[t],!0,!1),this.quests[t].oncomplete=function(){e.fulfilled++,e.quests[e.fulfilled]?e.quests[e.fulfilled].start():console.log("Adventure completed!")};this.quests[0].start()}}]),t}(M),t.Mod=function(){function e(t,i,n){s(this,e),this.id=t,this.init=i,this.callback=n;var a=function(){return b}();a.Item=k,a.Quest=M,this.init(a),b.mods.push(this),console.log("Mod "+this.id+" attached!")}return h(e,[{key:"update",value:function(){var e=function(){return b}();e.Item=k,e.Quest=M,this.callback(e)}},{key:"Get",value:function(e){return b[e]}},{key:"Set",value:function(e,t){if("scene"==e||"renderer"==e||"world"==e)throw"ModError: Permission denied to set "+e+"!";b[e]=t}}]),e}()},,function(e,t,i){"use strict";function n(e,t){localStorage[e]=t,s.savedData=localStorage}function a(){s.savedData=localStorage}function o(){localStorage.map||(localStorage.map="helmfirth"),a()}Object.defineProperty(t,"__esModule",{value:!0}),t.Save=n,t.Load=a,t.default=o;var s=i(0)},,function(e,t){e.exports={adventures:{test:{quests:["tutorial","betrayal"]}},quests:{tutorial:{id:"tutorial",name:"Tutorial",desc:"Learn the basics of the game.",listeners:["player.move","player.look"],onComplete:[{type:"give",target:"player",item:"doofus-helm"}]},betrayal:{id:"betrayal",name:"Sweet Betrayal",desc:"Kill Bert.  Leave no evidence.",listeners:[{id:"entity.kill",killer:"player"}],onComplete:[]}}}},function(e,t,i){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";o("#gui").is(":visible")||(o("#gui-title").text(e).click(function(){o("#gui").hide()}),o("#gui-content").html(t),document.exitPointerLock(),o("#gui").show())}function a(){var e=o("<div>");for(var t in s.player.inv.equipped){var i=s.player.inv.equipped[t];i&&o("<img>").attr("src",i.icon).attr("title",i.name).width(50).css("margin","3px").css("border","2px solid blue").data("item",i).appendTo(e)}for(var a in s.player.inv.inv){var r=s.player.inv.inv[a];r&&o("<img>").attr("src",r.icon).attr("title",r.name).width(50).css("margin","3px").data("item",r).appendTo(e)}e.on("click","img",function(e){e.preventDefault();var t=o(this).data("item");if(!/none/gi.test(o(this).css("border")))return o(this).css("border","none"),void s.player.inv.unequip(t.slot);s.player.inv.getSlot("rh")||(o(this).css("border","2px solid blue"),t.slot="rh",s.player.inv.equip(t.uuid))}),e.on("contextmenu","img",function(e){e.preventDefault();var t=o(this).data("item");if(!/none/gi.test(o(this).css("border")))return o(this).css("border","none"),void s.player.inv.unequip(t.slot);s.player.inv.getSlot("lh")||(o(this).css("border","2px solid blue"),t.slot="lh",s.player.inv.equip(t.uuid))}),new n("Inventory",e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,t.Inventory=a;var o=i(3),s=i(0);o(document).on("contextmenu",function(e){return e.preventDefault()})},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=i(6),o=n(a),s=i(19),r=n(s),l=i(20),h=n(l),u=i(28),c=n(u);i(0);(0,o.default)(),(0,r.default)(),(0,h.default)(),(0,c.default)(),i(29)},,,,,,function(e,t){e.exports={torch:{id:"torch",icon:"/assets/icons/torch.png",model:"/assets/models/torch/torch.json",type:"weapon",name:"Torch",desc:"A light to keep the dark at bay",slot:"hand",weight:5,value:3,stats:{dmg:3,spd:500,cooldown:400},meshData:{equipped:{scale:[.3,.3,.3],particles:"Fire",light:["#ffee55",1,60,2]}}},sword:{id:"sword",icon:"/assets/icons/one-handed-sword.png",model:"/assets/models/sword/sword.json",type:"weapon",name:"Shortsword",desc:"A small sword; handy yet light.",slot:"hand",weight:10,value:15,stats:{dmg:7,spd:1e3,cooldown:600},meshData:{general:{scale:[.12,.12,.12]}}},coin:{id:"coin",name:"Coin",desc:"Money. $_$"}}},function(e,t){e.exports={bert:{id:"bert",path:"/assets/models/character-base-male/character-base-male.json",name:"Bert",desc:"Close sibling of Billy the Blue Cube.",stats:{hpMax:70,stmMax:70},meshData:{offset:[0,-2.6,0],scale:[.5,.5,.5]}}}},function(e,t){e.exports={"house-1":{id:"house-1",path:"/assets/models/house-1.json",name:"House",desc:"A house.",spawn:[0,3,0],center:[0,0,0],meshData:{children:{door:{type:"link",location:"helmfirth",name:"To Helmfirth"}}}},helmfirth:{id:"helmfirth",path:"/assets/models/untitled/untitled.json",name:"Helmfirth",desc:"A small village, in the pit of The Grove.",spawn:[30,20,30],center:[0,20,0],meshData:{blender:!0,children:{door:{type:"link",location:"house-1",name:"Door"}}}}}},function(e,t,i){"use strict";function n(){var e=o.world;e.quatNormalizeSkip=0,e.quatNormalizeFast=!1;var t=new a.GSSolver;e.defaultContactMaterial.contactEquationStiffness=1e9,e.defaultContactMaterial.contactEquationRelaxation=4,t.iterations=7,t.tolerance=.1;e.solver=new a.SplitSolver(t),e.gravity.set(0,-20,0),e.broadphase=new a.NaiveBroadphase;var i=new a.Material("slipperyMaterial"),n=new a.ContactMaterial(i,i,{friction:.5,restitution:.3,contactEquationStiffness:1e8,contactEquationRelaxation:3,frictionEquationStiffness:1e8,frictionEquationRegularizationTime:3});e.addContactMaterial(n),o.mat=i}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var a=(i(1),i(2)),o=i(0)},function(e,t,i){"use strict";function n(){var e=l.scene;e.fog=new s.FogExp2(7833753,.01);var t=new s.AmbientLight(3351091);e.add(t);var n=["In the beginning, there was nothing...","...except a seed.","The seed was planted, and from it, a Tree;","A great, marvelous Tree - full of Power","One that would grow and spread...","And eventually form a giant forest.","It is this forest, that we call:","THE GROVE<br><small>[ play ]</small>"],h=0,u=!0;s.DefaultLoadingManager.onProgress=function(e,t,i){r("#instructions").text(Math.floor(t/i*100)+"% - v."+window.Grove.version)},s.DefaultLoadingManager.onLoad=function(){r("#instructions").click(function(){u=!1,r("#instructions").html("THE GROVE<br><small>[ play ]</small>")}),u&&r("#instructions").fadeOut(800),setTimeout(function(){u&&(r("#instructions").html(n[h]),r("#instructions").fadeIn(800),h++,h==n.length&&(u=!1),u?setTimeout(s.DefaultLoadingManager.onLoad,5e3):r("#instructions").html("THE GROVE<br><small>[ play ]</small>"))},800)},s.DefaultLoadingManager.onError=function(e){return console.error("Error loading "+e)};l.map=new o.Map(l.savedData.map);i(25);var c=l.renderer;c.shadowMap.enabled=!0,c.shadowMapSoft=!0,c.setSize(window.innerWidth,window.innerHeight),c.setClearColor(7833753,1),document.body.appendChild(c.domElement),window.addEventListener("resize",a,!1)}function a(){l.camera.aspect=window.innerWidth/window.innerHeight,l.camera.updateProjectionMatrix(),l.renderer.setSize(window.innerWidth,window.innerHeight)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var o=i(4),s=i(1),r=(i(2),i(3)),l=i(0)},function(e,t,i){"use strict";function n(){this.behavior.id="bystander";var e=this.nearestEntity();if(e){var t=(new o.Vector3).copy(e.mesh.position);t.y=this.mesh.position.y,this.mesh.lookAt(t)}}function a(){this.behavior.id="aggressive";var e=this.nearestEntity();if(e){var t=(new o.Vector3).copy(e.mesh.position);t.y=this.mesh.position.y,this.mesh.lookAt(t),this.body.quaternion.copy(this.mesh.quaternion);if(this.mesh.position.distanceTo(e.mesh.position)>5){var i=new s.Vec3(0,0,-1),n=new s.Vec3;this.body.vectorToWorldFrame(i,n),this.body.velocity.x-=n.x,this.body.velocity.z-=n.z,this.body.velocity.x>7?this.body.velocity.x=7:this.body.velocity.x<-7&&(this.body.velocity.x=-7),this.body.velocity.z>7?this.body.velocity.z=7:this.body.velocity.z<-7&&(this.body.velocity.z=-7)}else{this.body.velocity.x>1?this.body.velocity.x=1:this.body.velocity.x<-1&&(this.body.velocity.x=-1),this.body.velocity.z>1?this.body.velocity.z=1:this.body.velocity.z<-1&&(this.body.velocity.z=-1);var a=Math.random()<.5?"rh":"lh";this.attack(this.inv.getSlot(a).stats.dmg,e,a)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.bystander=n,t.aggressive=a;var o=i(1),s=i(2)},function(e,t,i){"use strict";function n(){var e=new r.Group({texture:{value:s.ImageUtils.loadTexture("/assets/icons/glow.png")}}),t=new r.Emitter({maxAge:{value:2},position:{value:new s.Vector3(0,0,0),spread:new s.Vector3(0,0,0)},acceleration:{value:new s.Vector3(0,-10,0),spread:new s.Vector3(10,0,10)},velocity:{value:new s.Vector3(0,25,0),spread:new s.Vector3(10,7.5,10)},color:{value:[new s.Color("red"),new s.Color("tan")]},size:{value:1},particleCount:2e3});e.addEmitter(t);var i={group:e,emitter:t};return l.particles.push(i),i}function a(){this.group=new r.Group({texture:{value:s.ImageUtils.loadTexture("/assets/icons/glow.png")},maxParticleCount:20,fog:!1}),this.emitter=new r.Emitter({maxAge:{value:1.5},position:{value:new s.Vector3(0,.5,0),spread:new s.Vector3(.1,.1,.1)},acceleration:{value:new s.Vector3(0,0,0),spread:new s.Vector3(.2,0,.2)},velocity:{value:new s.Vector3(0,1,0),spread:new s.Vector3(.2,0,.2)},color:{value:[new s.Color("orange"),new s.Color("yellow"),new s.Color("#111111")]},opacity:{value:[1,0]},size:{value:[1.5,1]},particleCount:20}),this.group.mesh.name=Math.random(),this.group.addEmitter(this.emitter),l.scene.add(this.group.mesh),l.particles.push(this)}function o(){this.group=new r.Group({texture:{value:s.ImageUtils.loadTexture("/assets/icons/glow.png")},maxParticleCount:2e3,fog:!0}),this.emitter=new r.Emitter({maxAge:{value:2},position:{value:new s.Vector3(0,0,0),spread:new s.Vector3(150,20,150)},acceleration:{value:new s.Vector3(0,0,0),spread:new s.Vector3(.1,.1,.1)},velocity:{value:new s.Vector3(0,0,0),spread:new s.Vector3(.1,.1,.1)},color:{value:[new s.Color("grey"),new s.Color("grey")]},opacity:{value:[0,1,1,0]},size:{value:[.1,.2]},particleCount:2e3}),this.group.addEmitter(this.emitter),l.scene.add(this.group.mesh),l.particles.push(this)}Object.defineProperty(t,"__esModule",{value:!0}),t.Basic=n,t.Fire=a,t.Ambient=o;var s=i(1),r=i(23),l=i(0)},,,function(e,t,i){"use strict";var n=i(4),a=i(0),o=(i(1),i(2)),s=i(26);i(27);var r=new o.Sphere(2),l=new o.Body({mass:5,material:a.mat});l.addShape(r),l.position.set(a.map.spawn[0],a.map.spawn[1],a.map.spawn[2]),l.linearDamping=.9,l.angularDamping=.95;var h=new s(a.camera,l);a.controls=h;var u=(a.player=new n.Player("player",h.getObject(),l),new o.Sphere(2.5)),c=new o.Body({mass:5});c.addShape(u),c.linearDamping=.9;var d=new n.NPC("bert",void 0,c);d.body.position.set(10,3,10);var p=new n.Item("torch");d.inv.add(p).equip(p.uuid),d.inv.add(new n.Item("sword"))},,,function(e,t,i){"use strict";function n(e){if(requestAnimationFrame(n),o.controls){var t=o.clock.getDelta(),i=!0,r=!1,l=void 0;try{for(var h,u=o.entities[Symbol.iterator]();!(i=(h=u.next()).done);i=!0){h.value.update()}}catch(e){r=!0,l=e}finally{try{!i&&u.return&&u.return()}finally{if(r)throw l}}var c=!0,d=!1,p=void 0;try{for(var v,f=o.particles[Symbol.iterator]();!(c=(v=f.next()).done);c=!0){var m=v.value;o.scene.getObjectByName(m.group.mesh.name)?m.group.tick(t):o.particles.slice(o.particles.indexOf(m),1)}}catch(e){d=!0,p=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw p}}a.update(e);var y=!0,w=!1,g=void 0;try{for(var b,x=o.mods[Symbol.iterator]();!(y=(b=x.next()).done);y=!0){b.value.update()}}catch(e){w=!0,g=e}finally{try{!y&&x.return&&x.return()}finally{if(w)throw g}}o.controls.enabled&&o.world.step(s),o.controls.update(Date.now()-o.time),o.renderer.render(o.scene,o.camera),o.time=Date.now(),o.events.publish("system.tick",{delta:e})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var a=i(5),o=i(0),s=1/60},function(e,t,i){"use strict";function n(e){var t="rh";if(3!=e.which&&78!=e.which||(t="lh"),u.player.inv.getSlot(t)&&0===u.player.holding[t].rotation.x){var i=new l.Raycaster;i.set(u.camera.getWorldPosition(),u.camera.getWorldDirection());var n=void 0,a=!0,o=!1,s=void 0;try{for(var r,h=u.entities[Symbol.iterator]();!(a=(r=h.next()).done);a=!0){var c=r.value;if("player"!=c.id){var d=i.intersectObjects(c.mesh.children,!0);d.length?n=c:d.length||n||(d=i.intersectObject(c.mesh,!0),d.length&&(n=c))}}}catch(e){o=!0,s=e}finally{try{!a&&h.return&&h.return()}finally{if(o)throw s}}n&&"living"==n.type&&u.player.attack(u.player.inv.getSlot(t).stats.dmg,n,t),0===u.player.holding[t].rotation.x&&(Date.now()-u.player.last.used[t]<u.player.inv.getSlot(t).stats.cooldown||u.player.publish("swing",{slot:t}))}}function a(){var e=new l.Raycaster;e.set(u.camera.getWorldPosition(),u.camera.getWorldDirection());var t=void 0,i=!0,n=!1,a=void 0;try{for(var o,s=u.entities[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var r=o.value;if("player"!=r.id){var h=e.intersectObjects(r.mesh.children,!0);h.length?t=r:h.length||t||(h=e.intersectObject(r.mesh,!0),h.length&&(t=r))}}}catch(e){n=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}t&&t.publish("interact",u.player)}function o(){function e(e){t=!0;var i="",n="[ Â· ]";"item"==e.type&&(n='<img src="/assets/icons/pick-up.png" width=35> '),"link"==e.type&&(n='<img src="/assets/icons/door-icon.png" width=35> '),"living"==e.type&&("bystander"==e.behavior.id?n='<img src="/assets/icons/talk.png" width=35> ':"aggressive"==e.behavior.id&&(n='<img src="/assets/icons/attack.png" width=35> ')),"map"!=e.type&&(i+=e.name),h("#crosshair-tooltip").html(i),h("#crosshair-icon").html(n)}p.set(u.camera.getWorldPosition(),u.camera.getWorldDirection());var t=!1,i=!0,n=!1,a=void 0;try{for(var o,s=u.entities[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var r=o.value;if("player"!=r.id&&r.mesh){var l=p.intersectObjects(r.mesh.children,!0);if(l.length)e(r);else if(!l.length&&!t){var c=p.intersectObject(r.mesh,!0);c.length&&e(r)}}}}catch(e){n=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}t||(h("#crosshair-tooltip").html(""),h("#crosshair-icon").html("[ Â· ]"))}var s=i(4),r=i(9),l=i(1),h=(i(5),i(3)),u=i(0),c=new s.Item("torch");u.player.inv.add(c).equip(c.uuid);var d=new s.Item("sword");u.player.inv.add(d).equip(d.uuid),h(window).on("click",function(e){u.controls.enabled&&(u.events.publish("system.click"),2==e.which||4==e.which?a():1!=e.which&&3!=e.which||n(e))}),h(window).on("keyup",function(e){u.controls.enabled&&(78==e.which||77==e.which?n(e):69==e.which?a():73==e.which&&(0,r.Inventory)("Character","[ loading ]"))});var p=new l.Raycaster;u.events.subscribe("system.tick",o)}],[10]);